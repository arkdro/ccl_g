package ccl

import (
	"reflect"
	"testing"
)

func Test_ccl(t *testing.T) {
	width := 16
	height := 7
	color_range := 3
	data := [][]int{
		{9, 1, 1, 1, 1, 1, 9, 9, 9, 2, 2, 2, 2, 2, 9, 9},
		{9, 1, 1, 1, 1, 1, 1, 9, 9, 2, 9, 9, 9, 2, 2, 9},
		{9, 1, 1, 9, 9, 1, 1, 9, 9, 2, 2, 9, 9, 2, 2, 9},
		{9, 1, 1, 9, 9, 1, 1, 9, 9, 2, 2, 2, 2, 2, 2, 9},
		{9, 1, 1, 1, 1, 1, 1, 9, 9, 2, 2, 2, 2, 2, 2, 9},
		{9, 1, 1, 1, 1, 1, 9, 9, 9, 2, 2, 2, 2, 2, 9, 9},
		{9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9},
	}
	expected_labels0 := [][]int{
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	}
	expected_labels1 := [][]int{
		{0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	}
	expected_labels2 := [][]int{
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0},
		{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	}
	expected_labels := []*[][]int{
		&expected_labels0,
		&expected_labels1,
		&expected_labels2,
	}
	labels := Ccl(width, height, color_range, &data)
	if !reflect.DeepEqual(labels, expected_labels) {
		t.Error("ccl labels mismatch")
	}
}

func Test_ccl2(t *testing.T) {
	width := 7
	height := 4
	color_range := 3
	data := [][]int{
		{1,1,0,2,2,2,2},
		{1,1,2,0,2,2,2},
		{0,1,1,2,2,1,0},
		{0,0,0,2,2,2,0},
	}
	expected_labels0 := [][]int{
		{0,0,1,0,0,0,0},
		{0,0,0,1,0,0,0},
		{2,0,0,0,0,0,3},
		{2,2,2,0,0,0,3},
	}
	expected_labels1 := [][]int{
		{1,1,0,0,0,0,0},
		{1,1,0,0,0,0,0},
		{0,1,1,0,0,2,0},
		{0,0,0,0,0,0,0},
	}
	expected_labels2 := [][]int{
		{0,0,0,1,1,1,1},
		{0,0,1,0,1,1,1},
		{0,0,0,1,1,0,0},
		{0,0,0,1,1,1,0},
	}
	expected_labels := []*[][]int{
		&expected_labels0,
		&expected_labels1,
		&expected_labels2,
	}
	labels := Ccl(width, height, color_range, &data)
	if !reflect.DeepEqual(labels, expected_labels) {
		t.Error("ccl 2 labels mismatch")
	}
}
